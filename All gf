public class GlobalFilterService {

    private final GlobalFilterRepository repository;

    public List<GlobalFilterRowDto> getGlobalFilters() {

        log.info("Service: Fetching global filters");

        List<GlobalFilterRowDto> data = repository.fetchGlobalFilterData();

        if (data == null || data.isEmpty()) {
            throw new DataNotFoundException("No global filter data found");
        }

        return data;
    }
}



@RestController
@RequestMapping("/pts")
@Api(tags = "PTS Global Filters")
@Slf4j
@RequiredArgsConstructor
public class GlobalFilterController {

    private final GlobalFilterService service;

    @GetMapping("/global-filters")
    @ApiOperation("Get all global filters data")
    @ApiResponses({
        @ApiResponse(code = 200, message = "Global filters fetched successfully"),
        @ApiResponse(code = 404, message = "No data found"),
        @ApiResponse(code = 500, message = "Internal server error")
    })
    public ResponseEntity<List<GlobalFilterRowDto>> getGlobalFilters() {

        log.info("Controller: GET /pts/global-filters");

        List<GlobalFilterRowDto> response = service.getGlobalFilters();

        return ResponseEntity.ok(response);
    }
}



import lombok.AllArgsConstructor;
import lombok.Data;

import java.time.LocalDateTime;

@Data
@AllArgsConstructor
public class ErrorResponse {

    private LocalDateTime timestamp;
    private int status;
    private String error;
    private String message;
    private String path;
}



@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(DataNotFoundException.class)
    public ResponseEntity<ErrorResponse> handleDataNotFound(
            DataNotFoundException ex,
            HttpServletRequest request) {

        log.warn("Data not found: {}", ex.getMessage());

        return new ResponseEntity<>(
            new ErrorResponse(
                LocalDateTime.now(),
                HttpStatus.NOT_FOUND.value(),
                "Data Not Found",
                ex.getMessage(),
                request.getRequestURI()
            ),
            HttpStatus.NOT_FOUND
        );
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGenericException(
            Exception ex,
            HttpServletRequest request) {

        log.error("Unhandled exception", ex);

        return new ResponseEntity<>(
            new ErrorResponse(
                LocalDateTime.now(),
                HttpStatus.INTERNAL_SERVER_ERROR.value(),
                "Internal Server Error",
                ex.getMessage(),
                request.getRequestURI()
            ),
            HttpStatus.INTERNAL_SERVER_ERROR
        );
    }
}

public class DataNotFoundException extends RuntimeException {

    public DataNotFoundException(String message) {
        super(message);
    }
}









package com.citi.rock.gwy.api.pts.controller;

import com.citi.rock.gwy.api.pts.dto.GlobalFilterResponseDto;
import com.citi.rock.gwy.api.pts.service.PtsDashboardService;

import lombok.extern.slf4j.Slf4j;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/pts")
@Slf4j
public class PtsUsecaseController {

    @Autowired
    private PtsDashboardService service;

    @GetMapping("/getFilters")
    public ResponseEntity<List<GlobalFilterResponseDto>> getGlobalFilters() {

        log.info("Controller: GET /pts/getFilters");

        List<GlobalFilterResponseDto> response = service.getGlobalFilters();

        return ResponseEntity.ok(response);
    }
}









// card1 






import lombok.Data;

@Data
public class RagStatusCountDto {

    private String projectOverallRagStatus;
    private Long useCaseCount;
}








@Repository
@RequiredArgsConstructor
@Slf4j
public class PtsDashboardRepository {

    private final NamedParameterJdbcTemplate jdbcTemplate;

    public List<RagStatusCountDto> getUseCaseCountByRagStatus(
            List<String> useCaseOwnership,
            List<String> useCaseCategory,
            List<Integer> milestoneYear,
            List<String> ragStatus) {

        String sql =
                "SELECT " +
                "  PROJECT_OVERALL_RAG_STATUS AS projectOverallRagStatus, " +
                "  COUNT(DISTINCT USE_CASE_NO) AS useCaseCount " +
                "FROM CFMUDMCC.ROCK_CO_PTS_EXEC_DSHBRD_VW " +
                "WHERE CO_TYPE = 'CO Milestone' " +
                "  AND USE_CASE_NO IS NOT NULL " +
                "  AND PROJECT_OVERALL_RAG_STATUS <> 'NA' " +
                "  AND RAG_STATUS <> 'NA' " +
                "  AND (:useCaseOwnership IS NULL OR USE_CASE_OWNERSHIP IN (:useCaseOwnership)) " +
                "  AND (:useCaseCategory IS NULL OR USE_CASE_CATEGORY IN (:useCaseCategory)) " +
                "  AND (:milestoneYear IS NULL OR EXTRACT(YEAR FROM DUE_DATE) IN (:milestoneYear)) " +
                "  AND (:ragStatus IS NULL OR PROJECT_OVERALL_RAG_STATUS IN (:ragStatus)) " +
                "GROUP BY PROJECT_OVERALL_RAG_STATUS";

        Map<String, Object> params = new HashMap<>();
        params.put("useCaseOwnership", useCaseOwnership);
        params.put("useCaseCategory", useCaseCategory);
        params.put("milestoneYear", milestoneYear);
        params.put("ragStatus", ragStatus);

        return jdbcTemplate.query(
                sql,
                params,
                BeanPropertyRowMapper.newInstance(RagStatusCountDto.class)
        );
    }
}






@Service
@RequiredArgsConstructor
@Slf4j
public class PtsDashboardService {

    private final PtsDashboardRepository repository;

    public List<RagStatusCountDto> getUseCaseCountByRagStatus(
            List<String> useCaseOwnership,
            List<String> useCaseCategory,
            List<Integer> milestoneYear,
            List<String> ragStatus) {

        log.info("Fetching Use Case count by RAG status");
        return repository.getUseCaseCountByRagStatus(
                useCaseOwnership,
                useCaseCategory,
                milestoneYear,
                ragStatus
        );
    }
}




@RestController
@RequestMapping("/pts")
@RequiredArgsConstructor
@Slf4j
public class PtsUsecaseController {

    private final PtsDashboardService service;

    @GetMapping("/rag-status/count")
    public ResponseEntity<List<RagStatusCountDto>> getRagStatusCounts(
            @RequestParam(required = false) List<String> useCaseOwnership,
            @RequestParam(required = false) List<String> useCaseCategory,
            @RequestParam(required = false) List<Integer> milestoneYear,
            @RequestParam(required = false) List<String> ragStatus) {

        log.info("GET /pts/rag-status/count");

        return ResponseEntity.ok(
                service.getUseCaseCountByRagStatus(
                        useCaseOwnership,
                        useCaseCategory,
                        milestoneYear,
                        ragStatus
                )
        );
    }
}



@Data
public class GlobalFilterRequestDtoFrontend {
    private String USE_CASE_OWNERSHIP;
    private String USE_CASE_OWNER;
    private String USE_CASE_ACCOUNTABLE_EXECUTIVE;
    private String USE_CASE_CATEGORY;
    private String PROJECT_OVERALL_RAG_STATUS;
    private String USE_CASE_DUE_DT_YEAR;
    private String USE_CASE_DUE_DT_QTR;
    private String USE_CASE_DUE_DT_MONTH;
    private String SMT_ACCOUNTABLE_EXECUTIVE;
    private String MILESTONE_OWNER;
    private String DELIVERABLE_OWNER;
    private String MILESTONE_YEAR;
    private String MILESTONE_QTR;
    private String MILESTONE_MONTH;
    private String DELIVERABLE_YEAR;
    private String DELIVERABLE_QTR;
    private String DELIVERABLE_MONTH;
    private String INITIATIVE_NAME;
    private String PROGRAM_NAME;
    private String WORK_EFFORT_NAME;
    private String DERIVED_PROGRAM_CATEGORY;
    private String OCC_CONSENT_ORDER_ARTICLE;
    private String SUBPORTFOLIO_NAME;
    private String MILESTONE_RAG_STATUS;
    private String DELIVERABLE_RAG_STATUS;
}
