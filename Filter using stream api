@Repository
@RequiredArgsConstructor
public class GlobalFilterRepository {

    private final NamedParameterJdbcTemplate jdbcTemplate;

    public List<Map<String, Object>> fetchBaseData() {
        return jdbcTemplate.queryForList(BASE_QUERY, Map.of());
    }
}





private List<String> distinctString(List<Map<String, Object>> data, String key) {
    return data.stream()
            .map(row -> (String) row.get(key))
            .filter(Objects::nonNull)
            .distinct()
            .sorted()
            .toList();
}

private List<Integer> distinctInt(List<Map<String, Object>> data, String key) {
    return data.stream()
            .map(row -> (Integer) row.get(key))
            .filter(Objects::nonNull)
            .distinct()
            .sorted()
            .toList();
}








@Data
public class GlobalFilterResponse {
    private UseCaseFilter useCase;
    private OwnerFilter owner;
    private TimelineFilter timeline;
    private WorkEffortFilter workEffort;
    private MilestoneAttributesFilter milestoneAttributes;
    private RagStatusFilter ragStatus;
}










@Service
@RequiredArgsConstructor
public class GlobalFilterService {

    private final GlobalFilterRepository repository;

    public GlobalFilterResponse getGlobalFilters() {

        List<Map<String, Object>> data = repository.fetchBaseData();

        GlobalFilterResponse response = new GlobalFilterResponse();

        // ================= USE CASE =================
        UseCaseFilter useCase = new UseCaseFilter();
        useCase.setUseCaseNo(distinctString(data, "USE_CASE_NO"));
        useCase.setUseCaseOwnership(distinctString(data, "USE_CASE_OWNERSHIP"));
        useCase.setUseCaseOwner(distinctString(data, "USE_CASE_OWNER"));
        useCase.setUseCaseAccountableExecutive(distinctString(data, "USE_CASE_ACCOUNTABLE_EXECUTIVE"));
        useCase.setUseCaseRbcmType(distinctString(data, "USE_CASE_CATEGORY"));
        useCase.setUseCaseRagStatus(distinctString(data, "PROJECT_OVERALL_RAG_STATUS"));
        response.setUseCase(useCase);

        // ================= OWNER =================
        OwnerFilter owner = new OwnerFilter();
        owner.setAccountableExecutive(distinctString(data, "SMT_ACCOUNTABLE_EXECUTIVE"));
        owner.setMilestoneOwner(distinctString(data, "MILESTONE_OWNER"));
        owner.setDeliverableOwner(distinctString(data, "DELIVERABLE_OWNER"));
        response.setOwner(owner);

        // ================= TIMELINE =================
        TimelineFilter timeline = new TimelineFilter();
        timeline.setMilestoneYear(distinctInt(data, "MILESTONE_YEAR"));
        timeline.setDeliverableYear(distinctInt(data, "DELIVERABLE_YEAR"));
        response.setTimeline(timeline);

        // ================= WORK EFFORT =================
        WorkEffortFilter work = new WorkEffortFilter();
        work.setInitiative(distinctString(data, "INITIATIVE_NAME"));
        work.setProgram(distinctString(data, "PROGRAM_NAME"));
        work.setProject(distinctString(data, "WORK_EFFORT_NAME"));
        work.setProgramCategory(distinctString(data, "DERIVED_PROGRAM_CATEGORY"));
        response.setWorkEffort(work);

        // ================= ATTRIBUTES =================
        MilestoneAttributesFilter attr = new MilestoneAttributesFilter();
        attr.setArticle(distinctString(data, "OCC_CONSENT_ORDER_ARTICLE"));
        attr.setSubPortfolio(distinctString(data, "SUBPORTFOLIO_NAME"));
        response.setMilestoneAttributes(attr);

        // ================= RAG =================
        RagStatusFilter rag = new RagStatusFilter();
        rag.setMilestoneRag(distinctString(data, "MILESTONE_RAG_STATUS"));
        rag.setDeliverableRag(distinctString(data, "DELIVERABLE_RAG_STATUS"));
        response.setRagStatus(rag);

        return response;
    }
}









@RestController
@RequestMapping("/api/global-filters")
@RequiredArgsConstructor
public class GlobalFilterController {

    private final GlobalFilterService service;

    @GetMapping
    public GlobalFilterResponse getGlobalFilters() {
        return service.getGlobalFilters();
    }
}








//new sevice





package com.example.pts.service;

import com.example.pts.dto.GlobalFilterResponse;
import com.example.pts.repository.GlobalFilterRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class GlobalFilterService {

    private final GlobalFilterRepository repository;

    public GlobalFilterResponse getGlobalFilters() {

        // 1️⃣ Fetch base data once
        List<Map<String, Object>> data = repository.fetchBaseData();

        GlobalFilterResponse response = new GlobalFilterResponse();

        /* =======================
           1. USE CASE
           ======================= */
        response.setUseCaseNo(
                distinctString(data, "USE_CASE_NO")
        );

        response.setUseCaseOwnership(
                distinctString(data, "USE_CASE_OWNERSHIP")
        );

        response.setUseCaseOwner(
                distinctString(data, "USE_CASE_OWNER")
        );

        response.setUseCaseAccountableExecutive(
                distinctString(data, "USE_CASE_ACCOUNTABLE_EXECUTIVE")
        );

        response.setUseCaseRbcmType(
                distinctString(data, "USE_CASE_CATEGORY")
        );

        response.setUseCaseRagStatus(
                distinctString(data, "PROJECT_OVERALL_RAG_STATUS")
        );

        /* =======================
           2. OWNER
           ======================= */
        response.setAccountableExecutive(
                distinctString(data, "SMT_ACCOUNTABLE_EXECUTIVE")
        );

        response.setMilestoneOwner(
                distinctString(data, "MILESTONE_OWNER")
        );

        response.setDeliverableOwner(
                distinctString(data, "DELIVERABLE_OWNER")
        );

        /* =======================
           3. TIMELINE
           ======================= */
        response.setMilestoneYear(
                distinctInt(data, "MILESTONE_YEAR")
        );

        response.setDeliverableYear(
                distinctInt(data, "DELIVERABLE_YEAR")
        );

        /* =======================
           4. WORK EFFORT
           ======================= */
        response.setInitiative(
                distinctString(data, "INITIATIVE_NAME")
        );

        response.setProgram(
                distinctString(data, "PROGRAM_NAME")
        );

        response.setProject(
                distinctString(data, "WORK_EFFORT_NAME")
        );

        response.setProgramCategory(
                distinctString(data, "DERIVED_PROGRAM_CATEGORY")
        );

        /* =======================
           5. MILESTONE ATTRIBUTES
           ======================= */
        response.setArticle(
                distinctString(data, "OCC_CONSENT_ORDER_ARTICLE")
        );

        response.setSubPortfolio(
                distinctString(data, "SUBPORTFOLIO_NAME")
        );

        /* =======================
           6. RAG STATUS
           ======================= */
        response.setMilestoneRag(
                distinctString(data, "MILESTONE_RAG_STATUS")
        );

        response.setDeliverableRag(
                distinctString(data, "DELIVERABLE_RAG_STATUS")
        );

        return response;
    }

    /* =====================================================
       HELPER METHODS – BUSINESS TRANSFORMATION LOGIC
       ===================================================== */

    private List<String> distinctString(List<Map<String, Object>> data, String key) {
        return data.stream()
                .map(row -> row.get(key))
                .filter(Objects::nonNull)
                .map(Object::toString)
                .distinct()
                .sorted()
                .collect(Collectors.toList());
    }

    private List<Integer> distinctInt(List<Map<String, Object>> data, String key) {
        return data.stream()
                .map(row -> row.get(key))
                .filter(Objects::nonNull)
                .map(value -> ((Number) value).intValue())
                .distinct()
                .sorted()
                .collect(Collectors.toList());
    }
}
